<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Face Similarity Checker</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script>
    let lastVerified = null;
    let lastDistance = null;
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['Poppins', 'sans-serif'],
          },
          colors: {
            primary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
            },
            secondary: {
              50: '#fdf4ff',
              100: '#fae8ff',
              200: '#f5d0fe',
              300: '#f0abfc',
              400: '#e879f9',
              500: '#d946ef',
              600: '#c026d3',
              700: '#a21caf',
              800: '#86198f',
              900: '#701a75',
            },
          },
          backdropBlur: {
            xs: '2px',
          },
          boxShadow: {
            'neuro': '5px 5px 10px #121826, -5px -5px 10px #1e293b',
            'neuro-light': '5px 5px 10px #d1d5db, -5px -5px 10px #ffffff',
          },
          animation: {
            'ping-slow': 'ping 3s cubic-bezier(0, 0, 0.2, 1) infinite',
            'spin-slow': 'spin 3s linear infinite',
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
          }
        },
      },
    }
  </script>
  <style>
    /* Glassmorphism effect */
    .glass {
      background: rgba(15, 23, 42, 0.65);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }

    .glass-light {
      background: rgba(255, 255, 255, 0.65);
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      border: 1px solid rgba(0, 0, 0, 0.05);
    }

    /* Neumorphism effect */
    .neuro {
      border-radius: 16px;
      background: #172033;
      box-shadow: 5px 5px 10px #121826, -5px -5px 10px #1e293b;
    }

    .neuro-light {
      border-radius: 16px;
      background: #f3f4f6;
      box-shadow: 5px 5px 10px #d1d5db, -5px -5px 10px #ffffff;
    }

    /* Gradient animations */
    .gradient-border {
      position: relative;
      border-radius: 16px;
      padding: 4px;
      background-image: linear-gradient(
        45deg, 
        rgba(56, 189, 248, 0.8) 0%, 
        rgba(232, 121, 249, 0.8) 50%, 
        rgba(56, 189, 248, 0.8) 100%
      );
      background-size: 200% 200%;
      animation: gradient-animation 8s ease infinite;
      transition: background-image 0.5s ease;
    }

    body.dark .gradient-border {
      background-image: linear-gradient(
        45deg,
        rgba(120, 120, 120, 0.8) 0%,
        rgba(180, 180, 180, 0.8) 50%,
        rgba(120, 120, 120, 0.8) 100%
      );
    }

    @keyframes gradient-animation {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    /* Animated particles background */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
      transition: background-color 0.5s ease;
      background-color: rgba(15, 23, 42, 0.65);
    }

    body.dark .particles {
      background-color: rgba(255, 255, 255, 0.65);
    }

    .particle {
      position: absolute;
      border-radius: 50%;
      opacity: 0.3;
      transition: background-color 0.5s ease;
    }

    /* Canvas size for captured photos */
    #canvas1, #canvas2 {
      width: 100%;
      height: auto;
      max-height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    body.dark .particle {
      background-color: rgba(100, 100, 100, 0.3);
    }

    /* Custom Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 20px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background-color: rgba(156, 163, 175, 0.8);
    }

    /* Tooltip custom styles */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: max-content;
      max-width: 250px;
      background-color: rgba(30, 41, 59, 0.9);
      color: #fff;
      text-align: center;
      border-radius: 6px;
      padding: 8px 12px;
      position: absolute;
      z-index: 10;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      transform-origin: bottom center;
      box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.2);
      font-size: 0.8rem;
      pointer-events: none;
    }

    .tooltip .tooltiptext::after {
      content: "";
      position: absolute;
      top: 100%;
      left: 50%;
      margin-left: -5px;
      border-width: 5px;
      border-style: solid;
      border-color: rgba(30, 41, 59, 0.9) transparent transparent transparent;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
      transform: translateX(-50%) translateY(-5px);
    }

    /* File input custom styling */
    .file-input-label {
      display: block;
      position: relative;
      cursor: pointer;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .file-input-label:hover {
      transform: translateY(-2px);
    }

    .file-input-label:active {
      transform: translateY(0);
    }

    .file-input {
      position: absolute;
      left: -9999px;
    }

    /* Dark mode transitions */
    .dark-transition {
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
    }

    /* Loading animation */
    .loader {
      display: inline-block;
      position: relative;
      width: 80px;
      height: 80px;
    }
    
    .loader div {
      box-sizing: border-box;
      display: block;
      position: absolute;
      width: 64px;
      height: 64px;
      margin: 8px;
      border: 6px solid;
      border-radius: 50%;
      animation: loader 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
      border-color: currentColor transparent transparent transparent;
    }
    
    .loader div:nth-child(1) {
      animation-delay: -0.45s;
    }
    
    .loader div:nth-child(2) {
      animation-delay: -0.3s;
    }
    
    .loader div:nth-child(3) {
      animation-delay: -0.15s;
    }
    
    @keyframes loader {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    /* Pulse animation for face match */
    .pulse-match {
      animation: pulse-match 2s infinite;
    }

    @keyframes pulse-match {
      0% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7);
      }
      70% {
        box-shadow: 0 0 0 10px rgba(16, 185, 129, 0);
      }
      100% {
        box-shadow: 0 0 0 0 rgba(16, 185, 129, 0);
      }
    }

    /* Shake animation for no match */
    .shake-mismatch {
      animation: shake-mismatch 0.82s cubic-bezier(.36,.07,.19,.97) both;
    }

    @keyframes shake-mismatch {
      10%, 90% {
        transform: translate3d(-1px, 0, 0);
      }
      
      20%, 80% {
        transform: translate3d(2px, 0, 0);
      }

      30%, 50%, 70% {
        transform: translate3d(-4px, 0, 0);
      }

      40%, 60% {
        transform: translate3d(4px, 0, 0);
      }
    }

    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      opacity: 0;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 dark:from-gray-300 dark:to-gray-400 text-gray-200 dark:text-gray-900 min-h-screen flex flex-col items-center justify-center p-4 transition-all duration-300 dark-transition">
  <!-- Background particles -->
  <div class="particles" aria-hidden="true"></div>

  <!-- Theme toggle button -->
  <button id="themeToggle" aria-label="Toggle theme" class="fixed top-4 right-4 z-10 p-2 rounded-full bg-slate-700 dark:bg-white text-white dark:text-slate-800 shadow-lg hover:scale-110 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-primary-400">
    <i id="themeIcon" class="fa fa-moon text-lg"></i>
  </button>

  <div class="flex flex-col items-center justify-center w-full max-w-4xl">
    <!-- App header -->
    <div id="headerCard" class="gradient-border w-full mb-6 sticky top-0 z-50 transition-transform duration-300 ease-in-out">
      <div class="glass dark:glass-light w-full rounded-xl p-6 flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
        <div class="flex items-center">
          <i class="fas fa-id-badge text-4xl mr-4 text-primary-400 dark:text-primary-600"></i>
          <h1 class="text-3xl font-bold bg-gradient-to-r from-primary-400 to-secondary-400 dark:from-primary-600 dark:to-secondary-600 bg-clip-text text-transparent">
            Face Similarity Checker
          </h1>
        </div>
        <div class="flex space-x-4">
          <button id="uploadModeBtn" class="tooltip px-4 py-2 rounded-xl font-semibold bg-primary-600 hover:bg-primary-700 dark:bg-primary-500 dark:hover:bg-primary-700 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary-400 shadow-md" 
                  onclick="setMode('upload')" aria-label="Upload mode">
            <i class="fas fa-upload mr-2"></i> Upload Images
            <span class="tooltiptext">Upload two images to compare</span>
          </button>
          <button id="cameraModeBtn" class="tooltip px-4 py-2 rounded-xl font-semibold bg-gray-700 hover:bg-gray-600 dark:bg-gray-300 dark:hover:bg-gray-500 text-white dark:text-gray-900 transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 shadow-md" 
                  onclick="setMode('camera')" aria-label="Camera mode">
            <i class="fas fa-camera mr-2"></i> Use Camera
            <span class="tooltiptext">Use your camera to take two photos</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Main content area -->
    <div class="glass dark:glass-light w-full rounded-xl p-6 shadow-xl dark:bg-gray-100">
      <form id="predictForm" onsubmit="event.preventDefault(); predict();" class="text-left">
        <!-- Mode tabs indicator -->
        <div class="flex mb-6 justify-center space-x-2 text-sm text-gray-400 dark:text-gray-600">
          <div id="uploadTabIndicator" class="flex items-center">
            <i class="fas fa-upload mr-1"></i>
            <span>Upload Mode</span>
          </div>
          <div class="text-gray-500">|</div>
          <div id="cameraTabIndicator" class="flex items-center">
            <i class="fas fa-camera mr-1"></i>
            <span>Camera Mode</span>
          </div>
        </div>
        
        <!-- Upload mode -->
          <div id="uploadMode" class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-6">
          <div class="flex flex-col items-center">
            <div class="w-full mb-4">
              <label class="block mb-2 font-semibold text-primary-400 dark:text-primary-600">Image 1</label>
              <div class="file-input-label w-full rounded-lg border-2 border-dashed border-primary-400 dark:border-primary-600 flex flex-col items-center justify-center p-4 hover:border-primary-500 dark:hover:border-primary-700 bg-slate-800/50 dark:bg-white/50 transition-all relative overflow-hidden">
                <i id="uploadIcon1" class="fas fa-cloud-upload-alt text-4xl mb-2 text-primary-400 dark:text-primary-600"></i>
                <span id="uploadText1" class="text-sm text-center text-gray-300 dark:text-gray-600">Click or drag to upload</span>
                <input type="file" id="image1" accept="image/*" class="file-input" aria-label="Upload first image"/>
                <img id="preview1" class="hidden rounded-lg border-2 border-primary-400 dark:border-primary-600 transition-all duration-300 hover:scale-105 shadow-lg max-w-full" alt="Preview of first image"/>
                <button type="button" id="removeImage1" class="hidden absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition focus:outline-none" aria-label="Remove first image">
                  <i class="fas fa-times text-xs"></i>
                </button>
              </div>
            </div>
          </div>
          <div class="flex flex-col items-center">
            <div class="w-full mb-4">
              <label class="block mb-2 font-semibold text-secondary-400 dark:text-secondary-600">Image 2</label>
              <div class="file-input-label w-full rounded-lg border-2 border-dashed border-secondary-400 dark:border-secondary-600 flex flex-col items-center justify-center p-4 hover:border-secondary-500 dark:hover:border-secondary-700 bg-slate-800/50 dark:bg-white/50 transition-all relative overflow-hidden">
                <i id="uploadIcon2" class="fas fa-cloud-upload-alt text-4xl mb-2 text-secondary-400 dark:text-secondary-600"></i>
                <span id="uploadText2" class="text-sm text-center text-gray-300 dark:text-gray-600">Click or drag to upload</span>
                <input type="file" id="image2" accept="image/*" class="file-input" aria-label="Upload second image"/>
                <img id="preview2" class="hidden rounded-lg border-2 border-secondary-400 dark:border-secondary-600 transition-all duration-300 hover:scale-105 shadow-lg max-w-full" alt="Preview of second image"/>
                <button type="button" id="removeImage2" class="hidden absolute top-2 right-2 bg-red-500 text-white rounded-full w-6 h-6 flex items-center justify-center hover:bg-red-600 transition focus:outline-none" aria-label="Remove second image">
                  <i class="fas fa-times text-xs"></i>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Camera mode -->
        <div id="cameraMode" class="hidden space-y-6 mb-6">
          <div class="text-center">
            <label class="block mb-2 font-semibold text-green-400 dark:text-green-600">Camera Preview</label>
            <div class="relative rounded-lg overflow-hidden border-2 border-green-400 dark:border-green-600 shadow-lg transition-all duration-300">
              <video id="video" autoplay playsinline class="mx-auto w-full max-h-80 object-cover bg-slate-900 dark:bg-slate-200"></video>
              <div id="cameraOverlay" class="absolute inset-0 flex items-center justify-center bg-black/60 text-white opacity-0 transition-opacity duration-300 pointer-events-none">
                <div class="text-center">
                  <i class="fas fa-camera text-4xl mb-2"></i>
                  <p>Capturing...</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="flex flex-wrap justify-center gap-4">
            <button id="captureBtn" type="button" class="tooltip flex items-center justify-center bg-gradient-to-r from-green-500 to-emerald-600 dark:from-green-600 dark:to-emerald-700 text-white px-6 py-3 rounded-xl font-semibold hover:scale-105 transition-all duration-300 shadow-md focus:outline-none focus:ring-2 focus:ring-green-400" aria-label="Capture first photo">
              <i class="fas fa-camera mr-2"></i> Capture Photo 1
              <span class="tooltiptext">Take the first photo to compare</span>
            </button>
            <button id="captureBtn2" type="button" class="tooltip flex items-center justify-center bg-gradient-to-r from-green-500 to-emerald-600 dark:from-green-600 dark:to-emerald-700 text-white px-6 py-3 rounded-xl font-semibold hover:scale-105 transition-all duration-300 shadow-md focus:outline-none focus:ring-2 focus:ring-green-400" aria-label="Capture second photo">
              <i class="fas fa-camera mr-2"></i> Capture Photo 2
              <span class="tooltiptext">Take the second photo to compare</span>
            </button>
          </div>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="space-y-2">
              <label class="block font-semibold text-green-400 dark:text-green-600">Captured Photo 1</label>
              <div class="relative">
                <canvas id="canvas1" class="w-full rounded-lg border-2 border-green-400 dark:border-green-600 shadow-lg bg-slate-800/50 dark:bg-white/50"></canvas>
                <button type="button" id="downloadBtn1" class="hidden absolute bottom-2 right-2 bg-primary-600 dark:bg-primary-700 text-white rounded-lg px-2 py-1 text-sm hover:bg-primary-700 dark:hover:bg-primary-800 transition focus:outline-none shadow-md" aria-label="Download first photo">
                  <i class="fas fa-download mr-1"></i> Save
                </button>
              </div>
            </div>
            <div class="space-y-2">
              <label class="block font-semibold text-green-400 dark:text-green-600">Captured Photo 2</label>
              <div class="relative">
                <canvas id="canvas2" class="w-full rounded-lg border-2 border-green-400 dark:border-green-600 shadow-lg bg-slate-800/50 dark:bg-white/50"></canvas>
                <button type="button" id="downloadBtn2" class="hidden absolute bottom-2 right-2 bg-primary-600 dark:bg-primary-700 text-white rounded-lg px-2 py-1 text-sm hover:bg-primary-700 dark:hover:bg-primary-800 transition focus:outline-none shadow-md" aria-label="Download second photo">
                  <i class="fas fa-download mr-1"></i> Save
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Predict button -->
        <div class="text-center mt-8">
          <button id="predictBtn" type="submit" class="tooltip px-8 py-3 rounded-xl font-semibold bg-gradient-to-r from-primary-500 to-secondary-500 dark:from-primary-600 dark:to-secondary-600 text-white hover:scale-105 transition-all duration-300 shadow-lg flex items-center justify-center space-x-2 focus:outline-none focus:ring-2 focus:ring-primary-400" aria-label="Start comparison">
            <i class="fas fa-search-plus mr-2"></i>
            <span id="predictText">Compare Faces</span>
            <div id="loadingSpinner" class="hidden">
              <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>
            <span class="tooltiptext">Compare the two faces for similarity</span>
          </button>
        </div>
      </form>

      <!-- Results section -->
      <div id="resultContainer" class="hidden mt-8">
        <div class="border-t border-gray-700 dark:border-gray-300 pt-6">
          <h2 class="text-2xl font-bold text-center mb-6 text-primary-700 dark:text-primary-400">Analysis Results</h2>
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <div id="resultCard" class="glass dark:glass-light rounded-xl p-6 flex flex-col items-center justify-center">
              <div id="resultIconContainer" class="w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl"></div>
              <div id="result" class="text-xl font-semibold text-center"></div>
              <div id="resultDetails" class="mt-4 text-sm text-primary-600 dark:text-primary-300 text-center"></div>
              <div id="similarityPercentage" class="mt-2 text-sm text-primary-700 dark:text-primary-400 font-semibold text-center"></div>
              <div id="similarityInterpretation" class="mt-1 text-xs text-primary-500 dark:text-primary-300 italic text-center"></div>
              <div id="thresholdValue" class="mt-1 text-xs text-primary-500 dark:text-primary-300 italic text-center">Threshold: 0.60</div>
              <div id="imagePreviews" class="mt-4 flex justify-center gap-4">
                <img id="previewResult1" alt="Image 1 Preview" class="w-24 h-24 object-cover rounded-lg border-2 border-primary-400 dark:border-primary-600 shadow-md hidden" />
                <img id="previewResult2" alt="Image 2 Preview" class="w-24 h-24 object-cover rounded-lg border-2 border-secondary-400 dark:border-secondary-600 shadow-md hidden" />
              </div>
              <!-- Added share and export buttons -->
              <div class="mt-6 flex flex-wrap justify-center gap-4">
                <button id="shareX" class="tooltip px-4 py-2 rounded-xl font-semibold bg-blue-500 hover:bg-blue-600 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-md" aria-label="Share on X">
                  <i class="fab fa-x-twitter mr-2"></i> Share X
                  <span class="tooltiptext">Share results on X</span>
                </button>
                <button id="shareInstagramStory" class="tooltip px-4 py-2 rounded-xl font-semibold bg-pink-600 hover:bg-pink-700 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-pink-500 shadow-md" aria-label="Share on Instagram Story">
                  <i class="fab fa-instagram mr-2"></i> Share Instagram Story
                  <span class="tooltiptext">Share results on Instagram Story</span>
                </button>
                <button id="shareWhatsAppStory" class="tooltip px-4 py-2 rounded-xl font-semibold bg-green-600 hover:bg-green-700 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 shadow-md" aria-label="Share on WhatsApp Story">
                  <i class="fab fa-whatsapp mr-2"></i> Share WhatsApp Story
                  <span class="tooltiptext">Share results on WhatsApp Story</span>
                </button>
                <button id="exportPDF" class="tooltip px-4 py-2 rounded-xl font-semibold bg-red-600 hover:bg-red-700 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-500 shadow-md" aria-label="Export as PDF">
                  <i class="fas fa-file-pdf mr-2"></i> Export PDF
                  <span class="tooltiptext">Export results as PDF</span>
                </button>
                <button id="exportImage" class="tooltip px-4 py-2 rounded-xl font-semibold bg-yellow-500 hover:bg-yellow-600 text-white transition-all duration-300 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-yellow-400 shadow-md" aria-label="Export as Image">
                  <i class="fas fa-file-image mr-2"></i> Export Image
                  <span class="tooltiptext">Export results as Image</span>
                </button>
              </div>
            </div>
            
            <div class="glass dark:glass-light rounded-xl p-6">
              <h3 class="text-lg font-semibold mb-4 text-center">Similarity Score</h3>
              <div class="flex justify-center items-center h-48">
                <canvas id="similarityChart" width="300" height="300"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="mt-6 text-center text-sm text-gray-500 dark:text-gray-600">
      <p>Face Similarity Checker &copy; 2025</p>
      <p class="mt-1">Privacy notice: Images are processed locally and not stored on any server.</p>
    </div>
  </div>

  <!-- Notification system -->
  <div id="notificationContainer" class="fixed bottom-4 right-4 z-50 flex flex-col space-y-2 transition-all duration-300 transform translate-y-10 opacity-0 pointer-events-none">
    <!-- Notifications will be inserted here via JavaScript -->
  </div>

  <!-- Loading overlay -->
  <div id="loadingOverlay" class="fixed inset-0 bg-black/70 dark:bg-gray-100/70 flex items-center justify-center z-50 hidden">
    <div class="glass dark:glass-light rounded-xl p-8 text-center max-w-sm">
      <div class="loader mb-4 text-primary-400 dark:text-primary-600">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
      </div>
      <h3 class="text-xl font-bold mb-2">Analyzing...</h3>
      <p class="text-gray-400 dark:text-gray-600">Comparing facial features and calculating similarity score</p>
    </div>
  </div>

  <script>
    // DOM Elements
    const uploadModeBtn = document.getElementById('uploadModeBtn');
    const cameraModeBtn = document.getElementById('cameraModeBtn');
    const uploadModeDiv = document.getElementById('uploadMode');
    const cameraModeDiv = document.getElementById('cameraMode');
    const image1 = document.getElementById('image1');
    const image2 = document.getElementById('image2');
    const preview1 = document.getElementById('preview1');
    const preview2 = document.getElementById('preview2');
    const uploadIcon1 = document.getElementById('uploadIcon1');
    const uploadIcon2 = document.getElementById('uploadIcon2');
    const uploadText1 = document.getElementById('uploadText1');
    const uploadText2 = document.getElementById('uploadText2');
    const removeImage1 = document.getElementById('removeImage1');
    const removeImage2 = document.getElementById('removeImage2');
    const video = document.getElementById('video');
    const canvas1 = document.getElementById('canvas1');
    const canvas2 = document.getElementById('canvas2');
    const captureBtn1 = document.getElementById('captureBtn');
    const captureBtn2 = document.getElementById('captureBtn2');
    const predictBtn = document.getElementById('predictBtn');
    const predictText = document.getElementById('predictText');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const resultContainer = document.getElementById('resultContainer');
    const resultDiv = document.getElementById('result');
    const resultIconContainer = document.getElementById('resultIconContainer');
    const resultDetails = document.getElementById('resultDetails');
    const resultCard = document.getElementById('resultCard');
    const cameraOverlay = document.getElementById('cameraOverlay');
    const uploadTabIndicator = document.getElementById('uploadTabIndicator');
    const cameraTabIndicator = document.getElementById('cameraTabIndicator');
    const downloadBtn1 = document.getElementById('downloadBtn1');
    const downloadBtn2 = document.getElementById('downloadBtn2');
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const loadingOverlay = document.getElementById('loadingOverlay');
    const notificationContainer = document.getElementById('notificationContainer');

    // State variables
    let currentMode = 'upload';
    let stream = null;
    let capturedImageBlob1 = null;
    let capturedImageBlob2 = null;
    let similarityChart = null;
    let isDarkMode = false;

    // Initialize page
    window.addEventListener('DOMContentLoaded', () => {
      createParticlesBackground();
      checkDarkModePreference();
      setMode('upload');
      updateTabIndicators();
      setupShareExportButtons();
    });

    // Theme toggle
    function checkDarkModePreference() {
      if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
        toggleDarkMode(true);
      }
    }

    themeToggle.addEventListener('click', () => {
      toggleDarkMode(!isDarkMode);
    });

    function toggleDarkMode(enable) {
      isDarkMode = enable;
      if (enable) {
        document.body.classList.add('dark');
        themeIcon.className = 'fa fa-sun text-lg';
      } else {
        document.body.classList.remove('dark');
        themeIcon.className = 'fa fa-moon text-lg';
      }
    }

    // Update tab indicators based on current mode
    function updateTabIndicators() {
      if (currentMode === 'upload') {
        uploadTabIndicator.classList.add('text-primary-400', 'dark:text-primary-600', 'font-medium');
        uploadTabIndicator.classList.remove('text-gray-400', 'dark:text-gray-600');
        cameraTabIndicator.classList.add('text-gray-400', 'dark:text-gray-600');
        cameraTabIndicator.classList.remove('text-green-400', 'dark:text-green-600', 'font-medium');
      } else {
        cameraTabIndicator.classList.add('text-green-400', 'dark:text-green-600', 'font-medium');
        cameraTabIndicator.classList.remove('text-gray-400', 'dark:text-gray-600');
        uploadTabIndicator.classList.add('text-gray-400', 'dark:text-gray-600');
        uploadTabIndicator.classList.remove('text-primary-400', 'dark:text-primary-600', 'font-medium');
      }
    }

    // Mode switching
    function setMode(mode) {
      currentMode = mode;
      
      // Update UI
      if (mode === 'upload') {
        uploadModeDiv.classList.remove('hidden');
        cameraModeDiv.classList.add('hidden');
        uploadModeBtn.classList.add('bg-primary-600', 'hover:bg-primary-700', 'dark:bg-primary-500', 'dark:hover:bg-primary-600');
        uploadModeBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600', 'dark:bg-gray-300', 'dark:hover:bg-gray-400');
        cameraModeBtn.classList.remove('bg-green-600', 'hover:bg-green-700', 'dark:bg-green-500', 'dark:hover:bg-green-600');
        cameraModeBtn.classList.add('bg-gray-700', 'hover:bg-gray-600', 'dark:bg-gray-300', 'dark:hover:bg-gray-400');
        stopCamera();
      } else {
        uploadModeDiv.classList.add('hidden');
        cameraModeDiv.classList.remove('hidden');
        uploadModeBtn.classList.remove('bg-primary-600', 'hover:bg-primary-700', 'dark:bg-primary-500', 'dark:hover:bg-primary-600');
        uploadModeBtn.classList.add('bg-gray-700', 'hover:bg-gray-600', 'dark:bg-gray-300', 'dark:hover:bg-gray-400');
        cameraModeBtn.classList.add('bg-green-600', 'hover:bg-green-700', 'dark:bg-green-500', 'dark:hover:bg-green-600');
        cameraModeBtn.classList.remove('bg-gray-700', 'hover:bg-gray-600', 'dark:bg-gray-300', 'dark:hover:bg-gray-400');
        startCamera();
      }
      
      // Update tab indicators
      updateTabIndicators();
      
      // Reset results
      hideResults();
    }

    // Hide results
    function hideResults() {
      resultContainer.classList.add('hidden');
      if (similarityChart) {
        similarityChart.destroy();
        similarityChart = null;
      }
    }

    // Particles background
    function createParticlesBackground() {
      const particlesContainer = document.querySelector('.particles');
      const particlesCount = 25;
      const colors = ['#0ea5e9', '#d946ef', '#10b981'];
      const maxSize = 15;
      
      for (let i = 0; i < particlesCount; i++) {
        const particle = document.createElement('div');
        particle.classList.add('particle');
        
        // Random properties
        const size = Math.floor(Math.random() * maxSize) + 5;
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        // Set particle styles
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.backgroundColor = color;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        
        // Add to container
        particlesContainer.appendChild(particle);
        
        // Animate particle
        animateParticle(particle);
      }
    }

    function animateParticle(particle) {
      // Random duration between 15-30 seconds
      const duration = Math.random() * 15000 + 15000;
      
      // Random start and end positions
      const startX = Math.random() * 100;
      const startY = Math.random() * 100;
      const endX = Math.random() * 100;
      const endY = Math.random() * 100;
      
      // Set starting position
      particle.style.left = `${startX}%`;
      particle.style.top = `${startY}%`;
      
      // Animate
      const start = Date.now();
      
      function frame() {
        const elapsed = Date.now() - start;
        const progress = elapsed / duration;
        
        if (progress >= 1) {
          // Reset animation
          animateParticle(particle);
          return;
        }
        
        // Calculate new position
        const currentX = startX + (endX - startX) * progress;
        const currentY = startY + (endY - startY) * progress;
        
        // Update position
        particle.style.left = `${currentX}%`;
        particle.style.top = `${currentY}%`;
        
        // Continue animation
        requestAnimationFrame(frame);
      }
      
      requestAnimationFrame(frame);
    }

    // Show notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `glass dark:glass-light rounded-lg p-4 shadow-lg flex items-center w-64 transform transition-all duration-300 translate-y-0 opacity-100`;
      
      let iconClass = 'fa-info-circle text-blue-500';
      if (type === 'success') iconClass = 'fa-check-circle text-green-500';
      if (type === 'error') iconClass = 'fa-exclamation-circle text-red-500';
      if (type === 'warning') iconClass = 'fa-exclamation-triangle text-yellow-500';
      
      notification.innerHTML = `
        <i class="fas ${iconClass} text-xl mr-3"></i>
        <p class="text-sm">${message}</p>
      `;
      
      notificationContainer.appendChild(notification);
      notificationContainer.classList.remove('translate-y-10', 'opacity-0', 'pointer-events-none');
      
      // Remove after timeout
      setTimeout(() => {
        notification.classList.add('translate-y-2', 'opacity-0');
        setTimeout(() => {
          notification.remove();
          if (notificationContainer.children.length === 0) {
            notificationContainer.classList.add('translate-y-10', 'opacity-0', 'pointer-events-none');
          }
        }, 300);
      }, 3000);
    }

    // Create confetti effect
    function createConfetti() {
      const resultCardRect = resultCard.getBoundingClientRect();
      const confettiCount = 50;
      const colors = ['#0ea5e9', '#d946ef', '#10b981', '#fbbf24', '#ef4444'];
      
      for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.classList.add('confetti');
        
        // Random properties
        const size = Math.floor(Math.random() * 10) + 5;
        const color = colors[Math.floor(Math.random() * colors.length)];
        
        // Set particle styles
        confetti.style.width = `${size}px`;
        confetti.style.height = `${size}px`;
        confetti.style.backgroundColor = color;
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        confetti.style.top = `${resultCardRect.top + resultCardRect.height / 2}px`;
        confetti.style.left = `${resultCardRect.left + resultCardRect.width / 2}px`;
        
        // Add to document
        document.body.appendChild(confetti);
        
        // Animate confetti
        animateConfetti(confetti);
      }
    }

    function animateConfetti(confetti) {
      const duration = Math.random() * 1000 + 1000;
      const startX = parseInt(confetti.style.left, 10);
      const startY = parseInt(confetti.style.top, 10);
      const endX = startX + (Math.random() * 200 - 100);
      const endY = startY - (Math.random() * 200 + 100);
      const rotation = Math.random() * 360;
      
      // Set starting position
      confetti.style.opacity = '1';
      
      // Animate
      const start = Date.now();
      
      function frame() {
        const elapsed = Date.now() - start;
        const progress = elapsed / duration;
        
        if (progress >= 1) {
          confetti.remove();
          return;
        }
        
        // Calculate new position with easing
        const easing = 1 - Math.pow(1 - progress, 3); // Cubic ease-out
        const currentX = startX + (endX - startX) * easing;
        const currentY = startY + (endY - startY) * easing;
        
        // Update position and rotation
        confetti.style.left = `${currentX}px`;
        confetti.style.top = `${currentY}px`;
        confetti.style.transform = `rotate(${rotation * progress}deg)`;
        
        // Fade out towards the end
        if (progress > 0.7) {
          confetti.style.opacity = `${1 - ((progress - 0.7) / 0.3)}`;
        }
        
        // Continue animation
        requestAnimationFrame(frame);
      }
      
      requestAnimationFrame(frame);
    }

    // Camera functions
    function startCamera() {
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } })
          .then(s => {
            stream = s;
            video.srcObject = stream;
            video.play().catch(err => console.error("Error playing video:", err));
          })
          .catch(err => {
            console.error("Camera access error:", err);
            showNotification('Camera access denied or not available.', 'error');
            setMode('upload');
          });
      } else {
        showNotification('Camera API not supported in this browser.', 'error');
        setMode('upload');
      }
    }

    function stopCamera() {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
      }
      video.srcObject = null;
      clearCanvas(canvas1);
      clearCanvas(canvas2);
      capturedImageBlob1 = null;
      capturedImageBlob2 = null;
      downloadBtn1.classList.add('hidden');
      downloadBtn2.classList.add('hidden');
    }

    function clearCanvas(canvas) {
      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
    }

    function capturePhoto(canvasElement, downloadBtn) {
      if (!stream) return;
      
      // Show camera overlay effect
      cameraOverlay.style.opacity = '1';
      setTimeout(() => {
        cameraOverlay.style.opacity = '0';
      }, 300);
      
      const context = canvasElement.getContext('2d');
      canvasElement.width = video.videoWidth;
      canvasElement.height = video.videoHeight;
      context.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
      
      // Show download button
      downloadBtn.classList.remove('hidden');
      
      // Apply capture sound and visual effect
      const captureSound = new Audio('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjI5LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWGluZwAAAA8AAAACAAADQADMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzM//////////////////////////////////////////////////////////////////8AAAAATGF2YzU4LjU0AAAAAAAAAAAAAAAAJAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//tAwAAA0dGo8AAAAAAAAA0gAAAAACA0lKAAMYA1OA6QAAAAIA58IABAnDFJG1a47g/rX7+cxqTN9ewkHKWARlZDBIwBAUGn/BO///1MYVB1gABACA0QYEQABDARhj6j2Lk/1PrJuDEAAgAQNBB1j/+lQwIlsAAAANqmhcCpBl/6MYA2fhZCBIWAAAcK7zSj//G3////EIXmOAJQGQtAQWjVKb//9dlE6UmqgJEBZBQEA3//tQwDmAzs0ywAMYGmBHGucAYYm6uP3YR2AAA0NoxgACQFACPDhKQAqAIwJAFRAUQFPAQRBMRBBMZRQOaGDxpwYGJngOFHKqDBQQCxggIpgAAA4QUCAkRAiIiLQxIJCJQCGIBAgBBBkQVJN4eGIiRKOJQIIACYREigQAQKAQQIo6BqJhgEjCgJMEi0DnhP+jJCQgERqRRDKBVgJbGYk7TJiMxCJAEjISMgEAq2zFREA==');
      captureSound.play().catch(err => console.error("Error playing sound:", err));
      
      return canvasElement.toBlob(blob => {
        if (canvasElement === canvas1) {
          capturedImageBlob1 = blob;
        } else {
          capturedImageBlob2 = blob;
        }
        showNotification('Photo captured successfully!', 'success');
      }, 'image/jpeg', 0.9);
    }

    // Download captured photos
    function downloadCapturedPhoto(canvas, num) {
      const link = document.createElement('a');
      link.download = `face-similarity-photo-${num}.jpg`;
      link.href = canvas.toDataURL('image/jpeg', 0.9);
      link.click();
      showNotification('Photo downloaded!', 'success');
    }

    // File handling
    function handleFileInputChange(input, preview, icon, text, removeBtn) {
      const [file] = input.files;
      if (file) {
        preview.src = URL.createObjectURL(file);
        preview.classList.remove('hidden');
        icon.classList.add('hidden');
        text.classList.add('hidden');
        removeBtn.classList.remove('hidden');
      }
    }

    function clearFileInput(input, preview, icon, text, removeBtn) {
      input.value = '';
      preview.src = '';
      preview.classList.add('hidden');
      icon.classList.remove('hidden');
      text.classList.remove('hidden');
      removeBtn.classList.add('hidden');
    }

    // Display similarity chart
    function displaySimilarityChart(distance, threshold = 0.6) {
      const normalizedDistance = Math.min(Math.max(distance, 0), 1);
      const similarity = 1 - normalizedDistance;
      const similarityPercentage = Math.round(similarity * 100);
      
      const chartData = {
        labels: ['Match', 'Difference'],
        datasets: [{
          data: [similarityPercentage, 100 - similarityPercentage],
          backgroundColor: [
            'rgba(16, 185, 129, 0.8)',
            'rgba(239, 68, 68, 0.8)'
          ],
          borderColor: [
            'rgba(16, 185, 129, 1)',
            'rgba(239, 68, 68, 1)'
          ],
          borderWidth: 1
        }]
      };
      
      const ctx = document.getElementById('similarityChart').getContext('2d');
      
      if (similarityChart) {
        similarityChart.destroy();
      }
      
      similarityChart = new Chart(ctx, {
        type: 'doughnut',
        data: chartData,
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              display: false
            },
            tooltip: {
              callbacks: {
                label: function(context) {
                  return `${context.label}: ${context.raw}%`;
                }
              }
            }
          },
          animation: {
            animateScale: true,
            animateRotate: true
          }
        }
      });
      
      // Add center text
      Chart.register({
        id: 'centerText',
        afterDraw: (chart) => {
          const width = chart.width;
          const height = chart.height;
          const ctx = chart.ctx;
          
          ctx.restore();
          const fontSize = (height / 114).toFixed(2);
          ctx.font = `${fontSize}em sans-serif`;
          ctx.textBaseline = 'middle';
          
          const text = `${similarityPercentage}%`;
          const textX = Math.round((width - ctx.measureText(text).width) / 2);
          const textY = height / 2;
          
          ctx.fillStyle = isDarkMode ? '#e5e7eb' : '#f9fafb';
          ctx.fillText(text, textX, textY);
          ctx.save();
        }
      });
    }

    // Prediction function
    function predict() {
      // Reset previous results
      hideResults();
      
      const formData = new FormData();
      
      // Validate inputs
      if (currentMode === 'upload') {
        if (!image1.files.length || !image2.files.length) {
          showNotification("Please upload both images.", "warning");
          return;
        }
        formData.append('image1', image1.files[0]);
        formData.append('image2', image2.files[0]);
      } else if (currentMode === 'camera') {
        if (!capturedImageBlob1 || !capturedImageBlob2) {
          showNotification("Please capture both photos.", "warning");
          return;
        }
        formData.append('image1', capturedImageBlob1, 'captured1.jpg');
        formData.append('image2', capturedImageBlob2, 'captured2.jpg');
      }
      
      // Show loading UI
      loadingOverlay.classList.remove('hidden');
      
      // Simulated API call (replace with actual fetch in production)
      setTimeout(() => {
        // Hide loading UI
        loadingOverlay.classList.add('hidden');
        
        // Simulate random result for demo
        const distance = Math.random();
        const verified = distance < 0.6;
        
        // Display results
        displayResults(verified, distance);
      }, 1500);
      
      /* In production, use actual API:
      fetch('/predict', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        loadingOverlay.classList.add('hidden');
        if (data.verified !== undefined) {
          displayResults(data.verified, data.distance);
        } else {
          showNotification('Error: ' + data.error, 'error');
        }
      })
      .catch((error) => {
        loadingOverlay.classList.add('hidden');
        showNotification('Prediction failed. Please try again.', 'error');
        console.error("Error:", error);
      });
      */
    }

    // Display results
    function displayResults(verified, distance) {
      // Show result container
      resultContainer.classList.remove('hidden');
      
      // Scroll to results
      resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
      
      // Format distance to 2 decimal places
      const formattedDistance = distance.toFixed(2);
      const similarityPercentage = Math.round((1 - Math.min(Math.max(distance, 0), 1)) * 100);
      let interpretation = '';
      if (similarityPercentage >= 80) {
        interpretation = 'High similarity';
      } else if (similarityPercentage >= 50) {
        interpretation = 'Moderate similarity';
      } else {
        interpretation = 'Low similarity';
      }
      
      // Update result text and styling
      if (verified) {
        resultDiv.innerHTML = `<span class="text-green-500 dark:text-green-400">✓ Match Confirmed</span>`;
        resultDetails.textContent = `Similarity distance: ${formattedDistance} (below threshold of 0.60)`;
        similarityPercentageElem.textContent = `Similarity: ${similarityPercentage}%`;
        similarityInterpretationElem.textContent = interpretation;
        thresholdValueElem.textContent = 'Threshold: 0.60';
        resultIconContainer.innerHTML = `<i class="fas fa-check-circle text-green-500 dark:text-green-400"></i>`;
        resultIconContainer.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl bg-green-100 dark:bg-green-900 pulse-match';
        resultCard.classList.add('border-green-500', 'dark:border-green-400');
        resultCard.classList.remove('border-red-500', 'dark:border-red-400');
        
        // Celebration effect
        createConfetti();
      } else {
        resultDiv.innerHTML = `<span class="text-red-500 dark:text-red-400">✗ No Match</span>`;
        resultDetails.textContent = `Similarity distance: ${formattedDistance} (above threshold of 0.60)`;
        similarityPercentageElem.textContent = `Similarity: ${similarityPercentage}%`;
        similarityInterpretationElem.textContent = interpretation;
        thresholdValueElem.textContent = 'Threshold: 0.60';
        resultIconContainer.innerHTML = `<i class="fas fa-times-circle text-red-500 dark:text-red-400"></i>`;
        resultIconContainer.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl bg-red-100 dark:bg-red-900 shake-mismatch';
        resultCard.classList.add('border-red-500', 'dark:border-red-400');
        resultCard.classList.remove('border-green-500', 'dark:border-green-400');
      }
      
      // Display similarity chart
      displaySimilarityChart(distance);

      // Show image previews if available
      if (currentMode === 'upload') {
        if (image1.files.length) {
          previewResult1.src = URL.createObjectURL(image1.files[0]);
          previewResult1.classList.remove('hidden');
        }
        if (image2.files.length) {
          previewResult2.src = URL.createObjectURL(image2.files[0]);
          previewResult2.classList.remove('hidden');
        }
      } else if (currentMode === 'camera') {
        if (capturedImageBlob1) {
          previewResult1.src = URL.createObjectURL(capturedImageBlob1);
          previewResult1.classList.remove('hidden');
        }
        if (capturedImageBlob2) {
          previewResult2.src = URL.createObjectURL(capturedImageBlob2);
          previewResult2.classList.remove('hidden');
        }
      }
    }
    function resetForm() {
      image1.value = '';
      image2.value = '';
      preview1.src = '';
      preview2.src = '';
      preview1.classList.add('hidden');
      preview2.classList.add('hidden');
      removeImage1.classList.add('hidden');
      removeImage2.classList.add('hidden');
      uploadIcon1.classList.remove('hidden');
      uploadIcon2.classList.remove('hidden');
      uploadText1.classList.remove('hidden');
      uploadText2.classList.remove('hidden');
    }

    // Optional: Allow drag & drop for file upload area
    const uploadAreas = document.querySelectorAll('.file-input-label');
    uploadAreas.forEach(area => {
      area.addEventListener('dragover', (e) => {
        e.preventDefault();
        area.classList.add('border-4', 'border-dashed', 'border-blue-400');
      });

      area.addEventListener('dragleave', () => {
        area.classList.remove('border-4', 'border-dashed', 'border-blue-400');
      });

      area.addEventListener('drop', (e) => {
        e.preventDefault();
        area.classList.remove('border-4', 'border-dashed', 'border-blue-400');
        const input = area.querySelector('input[type="file"]');
        if (e.dataTransfer.files.length > 0 && input) {
          input.files = e.dataTransfer.files;
          const preview = input.id === 'image1' ? preview1 : preview2;
          const icon = input.id === 'image1' ? uploadIcon1 : uploadIcon2;
          const text = input.id === 'image1' ? uploadText1 : uploadText2;
          const removeBtn = input.id === 'image1' ? removeImage1 : removeImage2;
          handleFileInputChange(input, preview, icon, text, removeBtn);
        }
      });
    });

  // Accessibility enhancement: Allow Enter key to trigger compare
  predictBtn.addEventListener('keyup', (e) => {
    if (e.key === 'Enter') predict();
  });

  // Add event listeners for file inputs to update previews
  image1.addEventListener('change', () => {
    handleFileInputChange(image1, preview1, uploadIcon1, uploadText1, removeImage1);
  });

  image2.addEventListener('change', () => {
    handleFileInputChange(image2, preview2, uploadIcon2, uploadText2, removeImage2);
  });

  // Add event listeners for remove buttons to clear inputs
  removeImage1.addEventListener('click', () => {
    clearFileInput(image1, preview1, uploadIcon1, uploadText1, removeImage1);
  });

  removeImage2.addEventListener('click', () => {
    clearFileInput(image2, preview2, uploadIcon2, uploadText2, removeImage2);
  });

  // Add event listeners for capture buttons to capture photos
  captureBtn1.addEventListener('click', () => {
    capturePhoto(canvas1, downloadBtn1);
  });

  captureBtn2.addEventListener('click', () => {
    capturePhoto(canvas2, downloadBtn2);
  });

  // Add event listeners for download buttons to download photos
  downloadBtn1.addEventListener('click', () => {
    downloadCapturedPhoto(canvas1, 1);
  });

  downloadBtn2.addEventListener('click', () => {
    downloadCapturedPhoto(canvas2, 2);
  });

  // Add event listeners for file input labels to trigger file input click
  const fileInputLabels = document.querySelectorAll('.file-input-label');
  fileInputLabels.forEach(label => {
    label.addEventListener('click', () => {
      const input = label.querySelector('input[type="file"]');
      if (input) {
        input.click();
      }
    });
  });

  // Add click event listener on predict button to trigger predict()
  predictBtn.addEventListener('click', () => {
    predict();
  });

  // Reset form input function moved outside displayResults for reuse
  function resetForm() {
    image1.value = '';
    image2.value = '';
    preview1.src = '';
    preview2.src = '';
    preview1.classList.add('hidden');
    preview2.classList.add('hidden');
    removeImage1.classList.add('hidden');
    removeImage2.classList.add('hidden');
    uploadIcon1.classList.remove('hidden');
    uploadIcon2.classList.remove('hidden');
    uploadText1.classList.remove('hidden');
    uploadText2.classList.remove('hidden');
  }

  // Call resetForm after displaying results to clear upload inputs
  function displayResults(verified, distance) {
    // Show result container
    resultContainer.classList.remove('hidden');
    
    // Scroll to results
    resultContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    
    // Format distance to 2 decimal places
    const formattedDistance = distance.toFixed(2);
    
    // Update result text and styling
    if (verified) {
      resultDiv.innerHTML = `<span class="text-green-500 dark:text-green-400">✓ Match Confirmed</span>`;
      resultDetails.textContent = `Similarity distance: ${formattedDistance} (below threshold of 0.60)`;
      resultIconContainer.innerHTML = `<i class="fas fa-check-circle text-green-500 dark:text-green-400"></i>`;
      resultIconContainer.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl bg-green-100 dark:bg-green-900 pulse-match';
      resultCard.classList.add('border-green-500', 'dark:border-green-400');
      resultCard.classList.remove('border-red-500', 'dark:border-red-400');
      
      // Celebration effect
      createConfetti();
    } else {
      resultDiv.innerHTML = `<span class="text-red-500 dark:text-red-400">✗ No Match</span>`;
      resultDetails.textContent = `Similarity distance: ${formattedDistance} (above threshold of 0.60)`;
      resultIconContainer.innerHTML = `<i class="fas fa-times-circle text-red-500 dark:text-red-400"></i>`;
      resultIconContainer.className = 'w-16 h-16 rounded-full flex items-center justify-center mb-4 text-3xl bg-red-100 dark:bg-red-900 shake-mismatch';
      resultCard.classList.add('border-red-500', 'dark:border-red-400');
      resultCard.classList.remove('border-green-500', 'dark:border-green-400');
    }
    
    // Display similarity chart
    displaySimilarityChart(distance);

    // Removed resetForm() call to keep uploaded photos visible after analysis
  }
    // Share and export buttons setup
    function setupShareExportButtons() {
      const shareX = document.getElementById('shareX');
      const shareInstagramStory = document.getElementById('shareInstagramStory');
      const shareWhatsAppStory = document.getElementById('shareWhatsAppStory');
      const exportPDF = document.getElementById('exportPDF');
      const exportImage = document.getElementById('exportImage');

      shareX.addEventListener('click', () => {
        if (lastVerified === null || lastDistance === null) {
          showNotification('No results to share yet.', 'warning');
          return;
        }
        const text = encodeURIComponent(`Face similarity check result: ${lastVerified ? 'Match' : 'No Match'} with distance ${lastDistance.toFixed(2)}.`);
        const url = encodeURIComponent(window.location.href);
        const xUrl = `https://twitter.com/intent/tweet?text=${text}&url=${url}`;
        window.open(xUrl, '_blank');
      });

      shareInstagramStory.addEventListener('click', async () => {
        if (lastVerified === null || lastDistance === null) {
          showNotification('No results to share yet.', 'warning');
          return;
        }
        const shareData = {
          title: 'Face Similarity Check Result',
          text: `Face similarity check result: ${lastVerified ? 'Match' : 'No Match'} with distance ${lastDistance.toFixed(2)}.`,
          url: window.location.href
        };
        if (navigator.share) {
          try {
            await navigator.share(shareData);
            showNotification('Shared successfully!', 'success');
          } catch (err) {
            showNotification('Sharing cancelled or failed.', 'error');
          }
        } else {
          alert('Sharing to Instagram Story is only supported via mobile app or browsers with Web Share API.');
        }
      });

      shareWhatsAppStory.addEventListener('click', () => {
        if (lastVerified === null || lastDistance === null) {
          showNotification('No results to share yet.', 'warning');
          return;
        }
        const text = encodeURIComponent(`Face similarity check result: ${lastVerified ? 'Match' : 'No Match'} with distance ${lastDistance.toFixed(2)}.`);
        const whatsappUrl = `https://wa.me/?text=${text}`;
        window.open(whatsappUrl, '_blank');
      });

      exportPDF.addEventListener('click', () => {
        if (lastVerified === null || lastDistance === null) {
          showNotification('No results to export yet.', 'warning');
          return;
        }
        exportResultsAsPDF();
      });

      exportImage.addEventListener('click', () => {
        if (lastVerified === null || lastDistance === null) {
          showNotification('No results to export yet.', 'warning');
          return;
        }
        exportResultsAsImage();
      });
    }

    // Export results as PDF using jsPDF and html2canvas
    async function exportResultsAsPDF() {
      try {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF();

        const resultCardElement = document.getElementById('resultCard');
        // Use html2canvas with better options for cross-origin and tainting
        const canvas = await html2canvas(resultCardElement, { scale: 2, useCORS: true, allowTaint: true, logging: true });
        const imgData = canvas.toDataURL('image/png');

        const imgProps = pdf.getImageProperties(imgData);
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;

        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save('face_similarity_result.pdf');
        showNotification('PDF exported successfully!', 'success');
      } catch (error) {
        console.error('Error exporting PDF:', error);
        showNotification('Failed to export PDF. Please try again.', 'error');
      }
    }

    // Export results as image using html2canvas
    async function exportResultsAsImage() {
      try {
        const resultCardElement = document.getElementById('resultCard');
        const canvas = await html2canvas(resultCardElement, { scale: 2, useCORS: true, allowTaint: true, logging: true });
        const imgData = canvas.toDataURL('image/png');

        const link = document.createElement('a');
        link.href = imgData;
        link.download = 'face_similarity_result.png';
        link.click();
        showNotification('Image exported successfully!', 'success');
      } catch (error) {
        console.error('Error exporting image:', error);
        showNotification('Failed to export image. Please try again.', 'error');
      }
    }

    // Override displayResults to store last results for sharing/exporting
    const originalDisplayResults = displayResults;
    displayResults = function(verified, distance) {
      lastVerified = verified;
      lastDistance = distance;
      originalDisplayResults(verified, distance);
    };

    const similarityPercentageElem = document.getElementById('similarityPercentage');
    const similarityInterpretationElem = document.getElementById('similarityInterpretation');
    const thresholdValueElem = document.getElementById('thresholdValue');
    const previewResult1 = document.getElementById('previewResult1');
    const previewResult2 = document.getElementById('previewResult2');
  </script>
  <style>
    #headerCard.hidden-up {
      transform: translateY(-100%);
      opacity: 0;
      pointer-events: none;
    }
  </style>
  <script>
    (function() {
      const headerCard = document.getElementById('headerCard');
      let lastScrollTop = window.pageYOffset || document.documentElement.scrollTop;
      let ticking = false;

      function onScroll() {
        const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
        if (scrollTop > lastScrollTop) {
          // Scrolling down - add hidden-up class
          headerCard.classList.add('hidden-up');
        } else {
          // Scrolling up - remove hidden-up class
          headerCard.classList.remove('hidden-up');
        }
        lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        ticking = false;
      }

      window.addEventListener('scroll', () => {
        if (!ticking) {
          window.requestAnimationFrame(onScroll);
          ticking = true;
        }
      });
    })();
  </script>
</body>
</html>
